## 결측치란(Missing Value)?

- 결측치란 말 그대로 `데이터에 값이 없는 것`을 뜻한다.

- 결측치의 종류, 표현
  
  - NaN : 값이 있어야 하는데 없는 결측으로 `대체, 추정, 예측` 등으로 처리

  - None : 값이 없는게 값인 결측(ex. 직업-백수)으로 새로운 값으로 정의하는 방식으로 처리- 

- 결측치는 데이터 분석을 하는데 있어 밑의 이유 때문에 반드시 처리를 해줘야 하는 값이다.

    - 결측치를 다 제거하면 막대한 데이터 손실을 부를 수 있다.

    - 결측치를 잘못 대체하면 데이터에서 편향이 생길 수 있다.
    
    - 결측치 처리에 분석가의 견해가 가장 많이 반영되고 분석결과가 매우 틀어질 수 있다.

- 이러한 이유들로 결측치 처리, 처리 방법을 선택하는 것은 매우 중요하다.

### 용어 정의

- 결측 레코드 : 결측치를 포함하는 레코드

- 결측치 비율 : 결측 레코드 수 / 전체 레코드 개수

![결측치 비율, 레코드 예시](attachment:image.png)


### 처리방법

- 제거 : 결측치가 있는 데이터를 제거하는 방법입니다. 이 방법은 결측치가 많은 경우에는 분석 결과에 영향을 미칠 수 있습니다.

- 행, 열 단위의 결측 삭제(제거)가 존재한다.


- 행단위 결측 삭제 : 결측 레코드의 `행을 삭제`하는 매우 간단한 방법이지만 `조건을 만족`하는 경우에만 수행할 수 있음
    1. 결측이 없는 레코드가 모델을 학습하는데 충분해야 함 -> 학습 샘플 개수에 따른 성능의 수렴여부 확인으로 결정
     - 학습 데이터의 양의 부족으로 성능이 급격하게 떨어질 수 있기 때문이다.
    2. 결측이 새로운 데이터에는 없어야 한다 - 도메인 지식 기반(해당 분야의 전문지식)의 판단
    
    
- 열단위 결측 삭제 : 결측 레코드를 포함하는 `열을 삭제`하는 매우 간단한 방법이지만 `조건을 만족`하는 경우에만 사용가능
    1. 어느 특정 변수에만 결측이 많이 포함되어 있음 -> 결측의 비율에 따라서 방법을 바꾼다.
    2. 해당 변수들이 크게 중요하지 않음(도메인지식)


- 이 외에도 밑에 있는 여러 가지 방법이 존재.

  - `평균값` 대체 : 결측치가 있는 데이터를 해당 열 전체의 평균값으로 대체하는 방법입니다. 이 방법은 결측치가 적은 경우에는 효과적이지만, 결측치가 많은 경우에는 분석 결과에 영향을 미칠 수 있습니다.

  - `중앙값` 대체 : 결측치가 있는 데이터를 해당 열 전체의 중앙값으로 대체하는 방법입니다. 이 방법은 결측치가 많은 경우에도 효과적이며, 평균값 대체보다 더 정확한 결과를 얻을 수 있습니다.

  - `임의값` 대체 : 결측치가 있는 데이터를 임의의 값으로 대체하는 방법입니다. 이 방법은 결측치가 많은 경우에는 효과적이지 않을 수 있습니다.


### 행단위, 열단위 삭제에 대해서 알아보자.

- 먼저 mammographic data 를 활용하기 위해 불러온다.

```
df = pd.read_csv('./데이터/mammographic.csv')
```

- `isnull()` 함수로 결측치의 개수를 확인한다.

    - isnull 은 pandas 라이브러리에서 제공하는 함수로 df 에서 결측치를 찾는데 사용된다.

    - false = 0, True = 1 로 처리 , 특성별(열별로) 결측의 수를 확인
    - 
    - axis=0 : 열별로 결측치 개수를 확인합니다.
    - axis=1 : 행별로 결측치 개수를 확인합니다.

``` 
# 결측치 개수 확인, 결측치를 찾아서 개수를 센다
# 여기서는 `열`별로 결측치를 찾는다.

df.isnull().sum(axis = 0) 

# 레코드별(행별)로 결측 확인, 가장 많은 결측치가 있는 `행`을 찾고 그 개수를 반환한다.
df.isnull().sum(axis = 1).max() 
```

- 결측치 비율을 확인, 구하기

  - `len(df)` 를 활용하여 전체 레코드 수를 구한다.

  - df.isnull().sum(axis = 0) 로 행별로 결측치 개수를 구한다.

  - `df.isnull().sum(axis = 0) / len(df)` 를 계산해 특성별 결측 비율을 확인한다.


- 그 결과를 확인

```
# 모든 특성에서 결측이 확인되고 있다 -> 열 단위 삭제는 불가능하다.

BI-RADS    0.002081
Age        0.005203
Shape      0.032258
Margin     0.049948
Density    0.079084
Output     0.000000
dtype: float64
```

- 결측 레코드의 비율도 계산할 수 있다.

```
# 결측 레코드 비율
(df.isnull().sum(axis = 1) > 0).sum() / len(df)
# 행을 기준으로 13% 정도 결측이 존재한다.
# 결측치가 높다. 새로 들오는 데이터느 결측치가 없어야 한다.
```

- 열단위 삭제

```
# df 를 가져온다.
df = pd.read_csv('./데이터/post_operative.csv')
```

- 중요한 점

- 데이터 제공측의 가이드에 의해서? ?는 NaN의 다른표시라는 걸 확인
    
    - 판단은 우리가 하는 것이 아니다.
    
    - 데이터에 대한 이해가 필요한 부분이다.(반드시 가이드를 확인해야 한다.)
    
    - ? 를 결측값인 NaN으로 변경 후 사용해야 한다.

- ? 는 문자열이므로 문자열 함수 replace 함수를 사용한다.
-  NaN은 numpy의 NaN 속성으로 사용 가능하다.

```
# 특성별 결측비율 확인
# ? -> nan 값으로 변환시켜준다.
df.replace('?', np.nan).isnull().sum()/len(df)
df_1 = df.replace('?', np.nan) 
```

- `df_1.dropna(axis = 1)` 를 활용, 결측이 있는 열을 삭제해준다.