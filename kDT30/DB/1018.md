## Aggregate function (집계 함수)

### count

- row의 갯수를 세는 것임
- 어떤 colunm 을 사용해도 같은 갯수가 나온다.
SELECT COUNT(*) FROM books;
SELECT COUNT(id) FROM books;

- 소속된 레코드의 숫자를 세준다.
  
```
중복 x 개수
SELECT COUNT(DISTINCT author_lname) FROM books;

# 제목에 the 가 들어간 책의 개수
SELECT COUNT(*) FROM books WHERE title LIKE '%the%';
SELECT COUNT(title) FROM books WHERE title LIKE '%the%';
```

-- Error(aggregated - non aggregated 는 동시 조회 불가능) sql mode full group by 에 의해서 2개를 동시에 보여줄 수는 없다.(incompatible)
SELECT titile, COUNT(*) FROM books WHERE title LIKE '%the%';


### group by

SELECT author_lname FROM books;

- 결과는 비슷하지만 실제로는 다르다.

- 겉으로 보이기에는 같지만 group by 는 group by 의 기준으로 data들이 묶여있는 것이라고 보면 된다.

- excel 의 피벗테이블과 유사하다.
SELECT author_lname FROM books GROUP BY author_lname;
SELECT DISTINCT author_lname FROM books;

-- group 되어져있는 레코드를 세어준다.
```
SELECT 
    author_lname, COUNT(*) AS COUNTER
FROM
    books
GROUP BY author_lname
-- 작가별 책이 많은 순으로 정렬
ORDER BY COUNTER DESC;
```

-- 2개를 기준으로 grouping 해서 정렬 가능
SELECT author_lname, author_fname, COUNT(*) FROM books
GROUP BY author_lname, author_fname; 

-- 2개 열을 합쳐서 새로운 열을 만들고 기준으로 사용
SELECT CONCAT(author_lname, ' ', author_fname) AS fullname, COUNT(*)
FROM books GROUP BY fullname;


### min, max

- group by 없이 사용
    -나타나는 값은 1개이지만 집계되어서 나오기 때문에 몇개의 값이 있을지 모른다.
SELECT MIN(released_year) FROM books;

- 가장 큰 page 
SELECT MAX(pages) FROM books;

- abc 순도 나타낼 수 있다.
SELECt MIN(author_lname), MAX(author_lname) FROM books;

- group by 함께 사용

  - 작가별 출판한 책 수, 가장 오래된 책 출판년도, 가장 최근 책 출판년도

```
SELECT -- 1) aggregated 2) group col
	author_lname AS '성', 
    author_fname AS '이름',
    COUNT(title) AS '책 수',
    MIN(released_year) AS '최고', 
    MAX(released_year) AS '최신'
FROM books
GROUP BY author_lname, author_fname;
```


### subquery

- aggregated 와 non aggregated 는 함께 조회 불가능
SELECT MAX(pages), title FROM books;

- 중복된 값을 도출하지 않는다.
SELECT title, pages FROM books
ORDER BY pages DESC LIMIT 1;

- 2줄 커리
SELECT MAX(pages) FROM books;
SELECT title, pages FROM books WHERE pages = 634;

- subquery 로 1줄로 처리
SELECT title, pages FROM books 
WHERE pages = (SELECT MAX(pages) FROM books);

- 가장 오래된 책

```
SELECT MIN(released_year) FROM books;
SELECT title, released_year FROM books WHERE released_year =1945;

SELECT title, released_year FROM books WHERE released_year =(SELECT MIN(released_year) FROM books);
```



### sum

- group_by 가 없으면 전체의 자동 합계
SELECT SUM(pages), SUM(stock_quantity) FROM books;

- 작가별 재고 수의 총 합

```
SELECT 
    author_fname, 
    author_lname, 
    SUM(stock_quantity)
FROM
    books
GROUP BY author_lname , author_fname;
```


### avg

- group by 없이 
SELECT AVG(pages) FROM books;

```
-- group by
SELECT 
    author_fname, 
    author_lname, 
    AVG(pages),
	SUM(pages) / COUNT(*)
FROM
    books
GROUP BY author_fname , author_lname
```