## Django's role in forms

### url 주소 변경하기

`<app_name>:<pattern_name>`

URL 을 변수로 사용하기 => app_name : name

app_name 활용하기

```
app_name = <url 명>

path('',views.index, name = 변수명),

# 파이썬 상에서는 `,` 을 허용하여 구분하여 작성해준다.
return redirect('board:detail', article.pk)

# HTML에서는 `,` 를 허용하지 않기 때문에 띄어쓰기로 구분해준다.
{% url "board:detail" article.pk %}
```

pattern name 을 설정해주면 자동으로 url이 할당된다.

## GET and POST

1.0 web 을 만드는 것이 아니라면 form tag 를 이해해야 한다.

이를 위해서 dejango 에서 편하게 제공하는 방식이 있다.

- where : 어디로 전송될 것인가??? -> action : url

- how : 어떤 방식으로 보낼 것인가???? , method 로 결정한다.  
  
    GET, POST 이 2가지를 사용한다.

### GET
     
    데이터를 가져온다. 
    보안적으로 약하다. 
    모든 내용이 URL에 공개가 된다. 
    모두가 다 볼 수 있는 방식이다. system 의 상태에 변화를 주지 않는 요청
    -> DB에 영향을 주지 않는 요청(Read)


### POST 
    
    데이터를 제출, 보내는 경우, 보이지 않게 전송한다. 
    system 의 상태 변화를 주는 요청은 POST 를 사용해야 한다.
    -> DB에 영향을 주는 요청들(Create, update, delete)
    CSRF protection 세팅이 필요하다.
    `{% csrf_token %}` -> 위조되지 않았음을 인증하는 것


#### POST 설정해보기

```
<form action={% url "board:create" %} method = "POST">
    {% csrf_token %} # 인증서 비슷한 것
```

설정 후, views에서 POST 방식으로 불러와야 한다.

```
    article.title = request.POST['title']
    article.content = request.POST['content']
```

### forms

Django 의 form 역할

- 그냥 form 과 Model form 이 있다.
- preparing and restructuring data to make it ready for rendering
- creating HTML forms for the data (순수하게 입력 데이터에서만 사용한다.)
- receiving and processing submitted forms and data from the client


### ModelForm

app 폴더에 forms.py 를 생성한다.

생성 후 안에 model 클래스를 입력해준다.


```
# board/forms
from django import forms
from .models import Article

# 1. 입력 데이터 검증 과정 X 
# 2. HTML 만들기 귀찮다

class ArticleForm(forms.ModelForm):

    # 0. 조건이다. (fields에 적힌 컬럼에 대해서만) 
    # 1. 입력 데이터 검증 -> 저장
    # 2. HTML(input/textarea/....)을 생성

    class Meta:
        model = Article
        fields = '__all__' # 모든 필드를 검증 후 저장
```

이후 HTML 에 `{{ form.as_p }}` 입력하면 자동으로 입력된 column에 맞게 작성해준다.

### Creat, Update 과정 form 을 활용한 축약

```
def create(request):

    # 데이터 입력
    form = ArticleForm(data=request.POST)
    
    # 데이터 검증 

    # 유효한 데이터라면,
    if form.is_valid():
        # validation -> 유효성 검증// is_(T or F return)
        # 저장
        article = form.save()
        return redirect('board:detail', article.pk)
    
    # 유효하지 않은 데이터라면,
    else:
        return render(request, 'board/new.html', {
            'form' : form,
        })

def update(request, pk):

    article = Article.objects.get(pk=pk)

    # 기존에 있는 data 를 가져온다.
    form = ArticleForm(data=request.POST, instance = article)
    
    # 데이터 검증 

    # 유효한 데이터라면,
    if form.is_valid():
        # validation -> 유효성 검증// is_(T or F return)
        # 저장
        article = form.save()
        return redirect('board:detail', article.pk)
    
    # 유효하지 않은 데이터라면,
    else:
        return render(request, 'board/edit.html', {
            'form' : form,
        })
 
```

+++ 이전의 edit code 도 수정해주자.

```
def edit(request, pk):
    article = Article.objects.get(pk=pk)

    # 기존의 데이터를 가져온다.
    form = ArticleForm(instance = article)

    return render(request, 'board/edit.html', {
        'article' : article,
        'form' : form,
    })
```