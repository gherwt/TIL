# what is kafka

## kafka란?

- 고성능 데이터 파이프라인, 스트리밍 분석, 데이터 통합 및 미션 크리티컬 애플리케이션을 위해 오픈 소스 `분산 이벤트 스트리밍 플랫폼`(distributed event streaming platform)이다. - 디스크 기반의 이벤트 보존

- 여기서 이벤트 스트리밍은 인체의 중추 신경계에 해당하는 디지털 처리 방식이다.

  - 지속적으로 발행, 구독한다./ 장애 발생 시 유실 복구가 가능하다.

  - 원하는 만큼 내구성 있고 안정적으로 저장한다.

  - 발생시 소급하여 처리한다.

- 이 모든 기능은 분산되고 확장성이 뛰어나고 탄력적이다. 또한 내결합성이 있으며 안전한 방식으로 제공된다고 한다. -> 수평 확장이 쉽게 가능 (단순히 브로커, 컨슈머, 파티션을 추가해 확장 가능)

- 브로거의 혁할은 컨슈머와 파티션 간 맵핑 관리만 하며 성능에 집중한다. 브로커가 하는 일이 비교적 단순하다. -> 메시지 필터, 재전송 같은 일은 컨슈머, 프로듀서에게 위임

- batch 기능을 제공하여 동시 처리량이 크다.

### 카프카의 특징

1- 카프카에 여러 전달자(Producer)가 동시에 메시지를 전송할 수 있고 반대로, 여러 소비자(Consumer)에서 동시에 메시지를 읽을 수 있다.

2- 한 노드가 메시지를 전송하면 전달자(Producer)와 소비자(Consumer)를 중재하는 브로커에서 전달자가 전달한 메시지를 브로커의 동작에 영향을 주지 않고 처리 속도 및 장애 복구를 유지할 수 있게 하기 위해 일정 기간 동안 파일 형태로 저장한다.

3- 시스템 트래픽이 높아지면 브로커를 추가해서 클러스터를 확장할 수 있다.

4- 처리 속도가 저하되면 소비자(Consumer) 또는 생산자 (Producer)를 추가하여 처리량을 늘릴 수 있다.
​
5- 소비자 (Consumer)가 프로듀서의 메시지 생성속도를 따라가지 못할 때 컨슈머를 그룹으로 묶어 프로듀서에서 보내는 속도와 읽는 속도의 균형을 맞출 수 있다.

### MQ(메시지 큐)

- 데이터 송수신을 의미하며 카프카에서 메시지 브로커 역할을 할 수 있도록 구현하여 사용하고 있다고 한다. -> 다중 프로듀서, 컨슈머가 상호 간섭없이 사용할 수 있다.

- 대용량의 실시간 로그 처리에 특화되어 TPS가 우수하다. - 고성능이다.

- 분산 처리에 효과적으로 설계 되어 병렬처리와 확장(Scaleout), 고가용성(HA) 용이 - 클러스터링

- 발행/구독(Publish-Subscribe) 모델 ( Push-Pull 구조 )

- 메시지를 받기를 원하는 컨슈머가 해당 토픽(topic)을 구독함으로써 메시지를 읽어 오는 구조

- 기존에 퍼블리셔나 브로커 중심적인 브로커 메시지와 달리 똑똑한 컨슈머 중심

- 브로커의 역할이 줄어들기 때문에 좋은 성능을 기대할 수 있음

- 파일 시스템에 메시지를 저장함으로써 영속성(durability)이 보장

- 장애시 데이터 유실 복구 가능

- 메시지가 많이 쌓여도 성능이 크게 저하되지 않음 -> 대규모 처리를 위한 batch 작업 용이하다고 한다

### 주요 개념 및 용어

- KafkaCluster : 카프카의 브로커들의 모임. Kafka는 확장성과 고가용성을 위하여 broker들이 클러스터로 구성

- Broker : 각각의 카프카 `서버`, 동일 노드에 여러 브로커를 띄울 수 있다.

- Zookeeper : 카프카 클러스터 정보 및 분산처리 관리 등 메타데이터 저장. 카프카를 띄우기 위해 반드시 실행되어야 함(곧 카프카 클러스터와 통합 예정)

- Producer : 메시지(이벤트)를 발행하여 `생산(Wirte)` 하는 주체

- Consumer : 메시지(이벤트)를 구독하여 `소비(Read)` 하는 주체

### 메시지의 구성 단위

- 메시지는 topic으로 분류, topic은 여러개의 patition으로 나눠짐

- Topic : 메시지를 구분하는 단위
  - 파일시스템의 폴더, 메일함과 유사함, 일종의 list 라고 할 수 있다. ex) 주문용 토픽, 결제용 토픽 등

- Partition : 메세지를 저장하는 물리적인 파일
  - 한 개의 토픽은 한 개 이상의 파티션으로 구성됨 
  - 파티션은 메시지 추가만 가능한 파일(append-only)

- offset : 파티션내 각 메시지의 저장된 상대적 위치
  - 프로듀서가 넣은 메시지는 파티션의 맨 뒤에 추가 (Queue)
  - 컨슈머는 오프셋 기준으로 마지막 커밋 시점부터 메시지를 순서대로 읽어서 처리함
  - 파티션의 메시지 파일은 처리 후에도 계속 저장되어 있며 설정에 따라 일정시간 뒤 삭제됨